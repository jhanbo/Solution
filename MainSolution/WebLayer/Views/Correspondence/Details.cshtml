@using ITGateWorkDesk.Web.Mvc.Models
@model ITGateWorkDesk.Web.Mvc.Models.CorrespondenceDetailsModel
@{
    ViewBag.Title = "Details";
    ViewBag.PageHeader = "Details";
}
@section HeaderSection
{
    <link href="../../Content/themes/base/jquery.ui.all.css" rel="stylesheet" type="text/css" />
    <script src="../../Scripts/jquery-ui-1.8.23.min.js" type="text/javascript"></script>
    <script src="../../Scripts/generalscripts.js" type="text/javascript"></script>
    <script src="../../Scripts/CorrDetailsScripts.js" type="text/javascript"></script>
}
            <div id="tabs">
                <ul>
                    <li><a href="#tabs-1">@ITGateWorkDesk.Resources.Resources.BasicInfo</a></li>
                    @if (!Model.IsDecision)
                    {
                        <li><a href="#tabs-2">@Html.LabelFor(model => model.Referrals)</a></li>
                    }
                    <li><a href="#tabs-3">@Html.LabelFor(model => model.Notes)</a></li>
                    <li><a href="#tabs-4">@Html.LabelFor(model => model.ChangeLog)</a></li>
                    <li><a href="#tabs-5">@ITGateWorkDesk.Resources.Resources.Attachements</a></li>
                </ul>
                @*Basic Info*@
                <div id="tabs-1">
                    <p>
                        @Html.LabelFor(model => model.CorrespondenceID) : @Model.CorrespondenceID
                        <br />
                        @if (Model.IsDecision)
                        { @ITGateWorkDesk.Resources.Resources.Decision}
                        else
                        { @ITGateWorkDesk.Resources.Resources.Correspondence} <strong>@Model.CorrespondenceOrigin</strong>

                        @Html.LabelFor(model => model.CorrDate) <strong>@Model.CorrDate</strong>
                        <br />
                        @Html.LabelFor(model => model.FromOrg) <strong>@Model.FromOrg</strong>
                        <br />
                        @Html.LabelFor(model => model.ToOrgs) <strong>@string.Join("<br />", @Model.ToOrgs.ToArray())</strong>
                        <br />
                        @Html.LabelFor(model => model.CcOrgs) <strong>@string.Join("<br />", @Model.CcOrgs.ToArray())</strong>
                        <br />
                    </p>
                </div>
                @*Assignments*@
                @if (!Model.IsDecision)
                {
                    <div id="tabs-2">
                    <p>
                        @if (Model.Referrals == null || !Model.Referrals.Any())
                        {
                            @ITGateWorkDesk.Resources.Resources.NoReferral
                        }
                        else
                        {
                            foreach (AssignmentViewModel assignment in Model.Referrals)
                            {
                                <text>@assignment.AssignmentId</text>
                            }
                        }
                        <br />
                        @Html.ActionLink(ITGateWorkDesk.Resources.Resources.AddAssignment, "Create", "Assignment", new { corrId = @Model.CorrespondenceID }, null)
                    </p>
                </div>
                }
                
                @*Notes*@
                <div id="tabs-3">
                    @if (Model.Notes == null || Model.Notes.Count() == 0)
                    {
                        <text>@ITGateWorkDesk.Resources.Resources.NoNotes</text>
                    }
                    else
                    {
                        <table>
                            <thead>
                                <th>@ITGateWorkDesk.Resources.Resources.NoteUser</th>
                                <th>@ITGateWorkDesk.Resources.Resources.NoteDate</th>
                                <th>@ITGateWorkDesk.Resources.Resources.Note</th>
                            </thead>
                            @foreach (CorrespondenceNoteModel note in Model.Notes)
                            {
                                <tr>
                                    <td>
                                        @note.User
                                    </td>
                                    <td>@note.NoteDate
                                    </td>
                                    <td>@note.Note
                                    </td>
                                </tr>    
                            }
                        </table>
                    }
                    @using (Html.BeginForm("Note", "Correspondence", FormMethod.Post, new { id = "SaveNoteForm" }))
                    {
                        <a href="#" id="addNoteLink">@ITGateWorkDesk.Resources.Resources.AddNewNote</a>
                        @Html.HiddenFor(model => model.CorrespondenceID)
                        <div id="AddNoteDialog" title="@ITGateWorkDesk.Resources.Resources.AddNewNote">
                            <textarea id="noteArea" rows="3" name="noteArea"></textarea>
                        </div>
                    }
                </div>
                @*ChangeLog*@
                <div id="tabs-4">
                    @if (Model.ChangeLog != null)
                    {
                        <table>
                            <tr>
                                <th>@ITGateWorkDesk.Resources.Resources.ChangeAction</th>
                                <th>@ITGateWorkDesk.Resources.Resources.ChangeDate</th>
                                <th>@ITGateWorkDesk.Resources.Resources.ChangeUser</th>
                            </tr>
                            @foreach (ITGateWorkDesk.Web.Mvc.Models.CorrespondeceChangeLogModel changeLog in Model.ChangeLog)
                            {
                                <tr>
                                    <td>@changeLog.ChangeAction
                                    </td>
                                    <td>@changeLog.ChangeDate
                                    </td>
                                    <td>@changeLog.ChangeUser
                                    </td>
                                </tr>
                            }
                        </table>
                    }
                </div>
                @*Attachments*@
                <div id="tabs-5">
                    @if (Model.Attachments != null && Model.Attachments.Count > 0)
                    {
                        <table>
                            @foreach (ITGateWorkDesk.Web.Mvc.Models.AttachmentModel attachment in Model.Attachments)
                            {
                                <tr>
                                    <td>@Html.ActionLink(attachment.FileName, "Download", new { id = attachment.ID })
                                    </td>
                                    <td>@attachment.Description
                                    </td>
                                    <td>@attachment.CreateDate.ToShortDateString()
                                    </td>
                                </tr>
                            }
                        </table>
                    }
                    else
                    {
                        @ITGateWorkDesk.Resources.Resources.NoAttachments
                    }
                </div>
            </div>
